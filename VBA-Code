Sub vba_stockmarket()
'Loop through each worksheet

    For Each WS In Worksheets

'apply headers so you understand what you are doing
    WS.Range("I1").Value = "Ticker"
    WS.Range("J1").Value = "Yearly_Change"
    WS.Range("K1").Value = "Percent_Change"
    WS.Range("L1").Value = "Total_Stock_Volume"
    WS.Range("O2").Value = "Greatest_Perc_Increase"
    WS.Range("O3").Value = "Greatest_Perc_Decrease"
    WS.Range("O4").Value = "Greatest_Total_Volume"
    WS.Range("P1").Value = "Ticker"
    WS.Range("Q1").Value = "Value"

'autofit column names so it looks v v nice
    WS.Range("I1").EntireColumn.AutoFit
    WS.Range("J1").EntireColumn.AutoFit
    WS.Range("K1").EntireColumn.AutoFit
    WS.Range("L1").EntireColumn.AutoFit
    WS.Range("O2").EntireColumn.AutoFit
    WS.Range("O3").EntireColumn.AutoFit
    WS.Range("P11").EntireColumn.AutoFit
    WS.Range("Q1").EntireColumn.AutoFit
    
 'define everything
    Dim Ticker As String
    Dim Total_Stock_Volume As Double
    Dim Yearly_Change As Double
    Dim Percent_Change As Double
    Dim Greatest_Perc_Increase As Double
    Dim Greatest_Perc_Decrease As Double
    Dim Greatest_Total_Volume As Double
    Dim Summary_Table_Row As Integer

    'define last row
    LastRow = WS.Cells(Rows.Count, 1).End(xlUp).Row
    Summary_Table_Row = 2
    
    Yearly_Open = WS.Cells(2, 3).Value
    For i = 2 To LastRow
    
        If WS.Cells(i + 1, 1) <> WS.Cells(i, 1) Then
    'find all individual values
            Ticker = WS.Cells(i, 1).Value
            Total_Stock_Volume = Total_Stock_Volume + WS.Cells(i, 7)
            Yearly_Close = WS.Cells(i, 6).Value
     'yearly change formula
            Yearly_Change = Yearly_Close - Yearly_Open
            
        If Yearly_Open = 0 Then
            Percent_Change = 0
        Else
    'percent change formula
            Percent_Change = (Yearly_Change / Yearly_Open) * 100
        
        End If
            WS.Range("I", Summary_Table_Row).Value = Ticker
            WS.Range("J", Summary_Table_Row).Value = Yearly_Change
            WS.Range("K", Summary_Table_Row).Value = (Percent_Change & "%")
            WS.Range("L", Summary_Table_Row).Value = Total_Stock_Volume
            Total_Stock_Volume = 0
            Yearly_Open = WS.Cells(i + 1, 3)
            

'Highlight green/red
        If WS.Range("J" & Summary_Table_Row).Value >= 0 Then
                WS.Range("J" & Summary_Table_Row).Interior.ColorIndex = 4
            Else
                WS.Range("J" & Summary_Table_Row).Interior.ColorIndex = 3
               End If
                  Summary_Table_Row = Summary_Table_Row + 1
           Else
               Total_Stock_Volume = Total_Stock_Volume + WS.Cells(i, 7)
       End If
    Next i
    Next WS
End Sub
